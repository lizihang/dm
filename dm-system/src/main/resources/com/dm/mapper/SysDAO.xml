<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dm.system.dao.SysDAO">

	<select id="getMenus" resultMap="menusResultMap">
		select
			m.id m_id, m.name m_name, m.router m_router,m.icon_class m_icon_class, m.group m_group, m.idx m_idx, m.level m_level, m.parent_id m_parent_id,
			g.*
		from
			dm_sys_menu m
		left join
			dm_sys_menu g
		on
			m.id = g.parent_id
		having
			m.level = 1
		order by
			m.idx asc,g.idx asc
	</select>

	<!--
		问题描述：在使用mybatis进行多表联合查询时，如果两张表中的字段名称形同，会出现无法正常映射的问题。
		解决办法：在查询时，给重复的字段起别名，然后在resultMap中使用别名进行映射。
		column：sql中的列名，如果有别名，写别名
		property：对应实体对象的属性
	-->
	<resultMap type="Menus" id="menusResultMap">
		<id column="m_id" property="id"/>
		<result column="m_name" property="name"/>
		<result column="m_router" property="router"/>
		<result column="m_icon_class" property="icon_class"/>
		<result column="m_group" property="group"/>
		<result column="m_idx" property="idx"/>
		<result column="m_level" property="level"/>
		<result column="m_parent_id" property="parent_id"/>
		<collection property="subMenus" ofType="Menu">
			<id column="id" property="id"/>
			<result column="name" property="name"/>
			<result column="router" property="router"/>
			<result column="icon_class" property="icon_class"/>
			<result column="group" property="group"/>
			<result column="idx" property="idx"/>
			<result column="level" property="level"/>
			<result column="parent_id" property="parent_id"/>
		</collection>
	</resultMap>

</mapper>